<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/addons/p5.sound.min.js"></script>
  <style>html,body{margin:0;background:#000;overflow:hidden}</style>
</head>
<body>
<script>
let sound, fft;
let stripes = 20;

function preload(){
  // 테스트용 오디오 — 같은 폴더에 mp3 파일 두기
  sound = loadSound('Music%20Sample_Lead.mp3');
}

function setup(){
  createCanvas(windowWidth, windowHeight);
  colorMode(HSB, 360, 100, 100);
  fft = new p5.FFT();
  noStroke();
}

function draw(){
  background(0);
  let spectrum = fft.analyze();
  let mid = fft.getEnergy('mid');   // 중역대
  let treb = fft.getEnergy('treble');

  let stripeWidth = width / stripes;
  for(let i=0; i<stripes; i++){
    let x = i * stripeWidth;
    // 파형 변위 — 주파수 기반
    let offset = sin(frameCount*0.02 + i*0.5) * map(mid, 0, 255, 0, 40);
    let hueBase = map(i, 0, stripes, 0, 360);
    for(let y=0; y<height; y++){
      let yy = y + offset * sin(y*0.02 + i*0.3 + frameCount*0.03);
      let hueShift = map(sin(yy*0.04), -1, 1, 0, 60);
      let col = color((hueBase + hueShift) % 360, 80, 100);
      fill(col);
      rect(x, y, stripeWidth+1, 1);
    }
  }
}

function mousePressed(){
  if (!sound.isPlaying()){
    sound.loop();
  }
}
</script>
</body>
</html>
