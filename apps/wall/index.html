<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PC ì•„ë°”íƒ€ ì›”ë“œ</title>
  <script src="https://unpkg.com/tone@next/build/Tone.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/addons/p5.sound.min.js"></script>
  <script type="module" src="./firebase-init.js"></script>
  <script type="module" src="./main.js"></script>
  <script>
    // ë¸Œë¼ìš°ì € ê¸°ë³¸ ìŠ¤í¬ë¡¤ ì™„ì „íˆ ë¹„í™œì„±í™”
    document.addEventListener('DOMContentLoaded', function() {
      // íœ  ìŠ¤í¬ë¡¤ ë°©ì§€
      window.addEventListener('wheel', function(e) {
        e.preventDefault();
      }, { passive: false });
      
      // í‚¤ë³´ë“œ ìŠ¤í¬ë¡¤ ë°©ì§€
      window.addEventListener('keydown', function(e) {
        if(['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'PageUp', 'PageDown', 'Home', 'End'].indexOf(e.code) > -1) {
          e.preventDefault();
        }
      }, false);
      
      // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ (ëª¨ë°”ì¼) - ìˆ˜ì •: ë‹¨ì¼ í„°ì¹˜ëŠ” í—ˆìš©
      document.addEventListener('touchstart', function(e) {
        if(e.touches.length > 1) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // touchmoveë§Œ ë°©ì§€í•˜ê³  touchendëŠ” í—ˆìš© (í´ë¦­ì„ ìœ„í•´)
      document.addEventListener('touchmove', function(e) {
        // ìŠ¤í¬ë¡¤ë§Œ ë°©ì§€í•˜ê³  í´ë¦­ì€ í—ˆìš©
        if(e.touches.length === 1) {
          const touch = e.touches[0];
          const canvas = document.querySelector('canvas');
          if(canvas && canvas.contains(e.target)) {
            // ìº”ë²„ìŠ¤ ë‚´ì—ì„œë§Œ í„°ì¹˜ ì´ë™ ë°©ì§€
            e.preventDefault();
          }
        } else {
          e.preventDefault();
        }
      }, { passive: false });
    });
  </script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #222;
      overflow: hidden; /* ë¸Œë¼ìš°ì € ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™” */
      height: 100vh;
      width: 100vw;
    }

    canvas {
      display: block;
      margin: 0 auto;
    }
    
    /* íŒ¬ ëª¨ë“œ ì»¤ì„œ ìŠ¤íƒ€ì¼ */
    .pan-mode {
      cursor: grab !important;
    }
    
    .pan-mode:active {
      cursor: grabbing !important;
    }

    /* íŒì—… ìŠ¤íƒ€ì¼ */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      display: none;
    }

    .popup-content {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 20px;
      border-radius: 15px 15px 0 0;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      max-height: 300px;
      overflow-y: auto;
    }

    .popup-close {
      position: absolute;
      top: 10px;
      right: 15px;
      background: #ddd;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .popup-close:hover {
      background: #ccc;
    }

    .avatar-info {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .avatar-image {
      width: 85px;  /* 68pxì—ì„œ 85pxë¡œ ì¦ê°€ (ì•½ 1.25ë°°) */
      height: 85px; /* 68pxì—ì„œ 85pxë¡œ ì¦ê°€ (ì•½ 1.25ë°°) */
      flex-shrink: 0;
      object-fit: cover;
    }

    .avatar-details h3 {
      margin: 0 0 10px 0;
      color: #333;
    }

    .nickname-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .nickname-text {
      font-weight: bold;
      color: #333;
    }

    .keywords-container {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .keyword-tag {
      background: #f0f0f0;
      color: #666;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .music-info {
      margin: 10px 0;
      color: #666;
      font-size: 14px;
    }

    .memory-text {
      margin-top: 15px;
      color: #888;
      font-size: 12px;
      line-height: 1.4;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }

    .avatar-details p {
      margin: 5px 0;
      color: #666;
      line-height: 1.4;
    }

    .help-text {
      margin-top: 15px;
      font-size: 12px;
      color: #999;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }

    /* íŒ¬ UI - ë¸Œë¼ìš°ì € ì°½ ìƒë‹¨ ê³ ì • */
    .pan-ui {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(100, 150, 255, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 15px;
      font-size: 16px;
      z-index: 100;
      display: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .camera-debug {
      position: fixed;
      top: 60px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-family: monospace;
      z-index: 100;
      display: block;
      line-height: 1.4;
      max-width: 300px;
    }

    /* ìƒë‹¨ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
    .top-buttons-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: row-reverse; /* ì˜¤ë¥¸ìª½ë¶€í„° ì™¼ìª½ìœ¼ë¡œ ë°°ì¹˜ */
      gap: 10px; /* ë²„íŠ¼ ê°„ ê°„ê²© */
      align-items: center;
    }

    /* ë¬´ëŒ€ ë¦¬ì…‹ ë²„íŠ¼ */
    .reset-stage-btn {
      background: rgba(255, 100, 100, 0.9);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      min-width: 120px; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
    }

    .reset-stage-btn:hover {
      background: rgba(255, 100, 100, 1);
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    .reset-stage-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .reset-stage-btn:disabled {
      background: rgba(150, 150, 150, 0.6);
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
      opacity: 0.6;
    }
    
    .reset-stage-btn:disabled:hover {
      background: rgba(150, 150, 150, 0.6);
      transform: none;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
    }

    /* ì•„ë°”íƒ€ ì •ë ¬ ë²„íŠ¼ */
    .sort-avatars-btn {
      background: rgba(100, 150, 255, 0.9);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      min-width: 120px; /* ìµœì†Œ ë„ˆë¹„ ë³´ì¥ */
    }

    .sort-avatars-btn:hover {
      background: rgba(100, 150, 255, 1);
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    .sort-avatars-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .sort-avatars-btn:disabled {
      background: rgba(120, 120, 120, 0.6);
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
      opacity: 0.6;
    }
    
    .sort-avatars-btn:disabled:hover {
      background: rgba(120, 120, 120, 0.6);
      transform: none;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>

<body>
  <!-- íŒ¬ UI - ë¸Œë¼ìš°ì € ì°½ ìƒë‹¨ ê³ ì • -->
  <div id="panUI" class="pan-ui">
    ğŸ–ï¸ í™”ë©´ ì´ë™ ì¤‘
  </div>
  
  <!-- ì¹´ë©”ë¼ ë””ë²„ê·¸ ì •ë³´ -->
  <div id="cameraDebug" class="camera-debug">
    ì¹´ë©”ë¼: (0, 0)
  </div>

  <!-- ìƒë‹¨ ë²„íŠ¼ë“¤ -->
  <div class="top-buttons-container">
    <!-- ë¬´ëŒ€ ë¦¬ì…‹ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ë) -->
    <button id="resetStageBtn" class="reset-stage-btn">
      ğŸ­ ë¬´ëŒ€ ë¦¬ì…‹
    </button>
    
    <!-- ì•„ë°”íƒ€ ì •ë ¬ ë²„íŠ¼ (ë¦¬ì…‹ ë²„íŠ¼ ì™¼ìª½) -->
    <button id="sortAvatarsBtn" class="sort-avatars-btn">
      ğŸ“ ì•„ë°”íƒ€ ì •ë ¬
    </button>
    
    <!-- TODO: ì¶”ê°€ ë²„íŠ¼ë“¤ì„ ì—¬ê¸°ì— ì¶”ê°€ ê°€ëŠ¥ -->
  </div>

  <!-- íŒì—… ì˜¤ë²„ë ˆì´ -->
  <div id="popupOverlay" class="popup-overlay">
    <div class="popup-content">
      <button class="popup-close" onclick="closePopup()">Ã—</button>
      <div class="avatar-info">
        <img id="popupAvatarImage" class="avatar-image" src="avatar_sample.jpeg" alt="ì•„ë°”íƒ€">
        <div class="avatar-details">
          <h3>ì•„ë°”íƒ€ ì •ë³´</h3>
          <div class="nickname-row">
            <span class="nickname-text"><span id="popupNickname">-</span></span>
            <div class="keywords-container" id="popupKeywords">
              <!-- í‚¤ì›Œë“œ íƒœê·¸ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
          <div class="music-info">
            <span id="popupMusicPosition">-</span> | <span id="popupSelectedRecipe">-</span>
          </div>
          <div class="memory-text" id="popupMemory">-</div>
        </div>
      </div>
      <div class="help-text">
        ì´ ì•„ë°”íƒ€ë¥¼ ë“œë˜ê·¸í•´ì„œ ì›í•˜ëŠ” ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        íŒì—… ì™¸ë¶€ë¥¼ í´ë¦­í•˜ê±°ë‚˜ Ã— ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>
  </div>
</body>

</html>